<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Writing tests | Leviathan Helpers</title>
	<meta name="description" content="Documentation for Leviathan Helpers">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="../../assets/css/main.css">
	<link rel="stylesheet" href="../../assets/css/pages.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="../../assets/js/search.json" data-base="../..">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="../../index.html" class="title">Leviathan Helpers</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="../../modules.html">Globals</a>
				</li>
				<li>
					<a href="quickstart.html">Getting-Started</a>
				</li>
				<li>
					<a href="writing-tests.html">Writing tests</a>
				</li>
			</ul>
			<h1>Writing tests</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#writing-new-tests-in-leviathan" id="writing-new-tests-in-leviathan" style="color: inherit; text-decoration: none;">
					<h1>Writing new tests in Leviathan</h1>
				</a>
				<p>The leviathan framework runs &#39;suites&#39;. A suite is a collection of tests and a configuration for the environment. The current suite that runs on meta-balena &amp; balena-raspberrypi PRs can be found <a href="https://github.com/balena-os/meta-balena/tree/master/tests/suites/os">here on GitHub</a>.</p>
				<p>Leviathan comprises a client, which sends test suites, and a testbot, which will listen for and execute suites. The client is a container that you can run on your laptop, or within an automated workflow to send tests to a testbot.</p>
				<p>As you can see from the linked meta-balena directory, we can set up a directory containing a test suite as follows:</p>
				<ul>
					<li><code>tests</code> - Folder containing actual tests</li>
					<li><code>conf.js</code> - File assigning configuration options</li>
					<li><code>package.json</code> - File containing the node dependencies to install for the test suite</li>
					<li><code>suite.js</code> - File where you can select what tests are run as part of the suite, and define your setup code to run before the tests start.</li>
				</ul>
				<p>Inside the tests folder, you can add the actual test logic. The recommended approach is to add a folder for each test (with an appropriate name), and inside, keep any assets associated with the test. The test can be written within a file called <code>index.js</code>. The tests folder will look something like:</p>
				<pre><code class="language-bash"><span style="color: #002339">- tests</span>
<span style="color: #002339">    - test-1</span>
<span style="color: #002339">        - assets</span>
<span style="color: #002339">        - index.js - the </span><span style="color: #1AB394">test</span><span style="color: #002339"> is written </span><span style="color: #7B30D0">in</span><span style="color: #002339"> this file</span>
<span style="color: #002339">    - test-2</span>
<span style="color: #002339">        - assets</span>
<span style="color: #002339">        - index.js</span>
<span style="color: #002339">    - </span><span style="color: #1AB394">.</span>
<span style="color: #002339">    - </span><span style="color: #1AB394">.</span>
<span style="color: #002339">    - etc </span>
</code></pre>
				<a href="#how-do-i-add-a-new-test" id="how-do-i-add-a-new-test" style="color: inherit; text-decoration: none;">
					<h2>How do I add a new test?</h2>
				</a>
				<p>To add a new test, you could either create a new suite, or a add a test to an existing suite.
				For reference, an old PR <a href="https://github.com/balena-os/leviathan/commit/0ec26632881ef2c262e67d30ebccaaf0611b01ad#diff-df7b8717d54947445c5900174e15e5cf">adding a test</a> to the OS test suite in Leviathan.</p>
				<a href="#adding-a-testtests-to-an-existing-suite" id="adding-a-testtests-to-an-existing-suite" style="color: inherit; text-decoration: none;">
					<h3>Adding a test/tests to an existing suite</h3>
				</a>
				<ol>
					<li>Navigate to the suite folder where the test needs to be added (for example <a href="https://github.com/balena-os/meta-balena/tree/master/tests/suites/os">https://github.com/balena-os/meta-balena/tree/master/tests/suites/os</a>). </li>
					<li>Navigate to the <code>/tests</code> directory inside that suite.</li>
					<li>Create a new directory <code>&lt;MY_NEw_TEST&gt;</code>, with an appropriate name for your test.</li>
					<li>Inside this new directory, create an <code>index.js</code> file</li>
					<li>Inside <code>index.js</code>, test logic lives (details about writing the test logic are explained in the next section)</li>
					<li>Going back to the suite directory, navigate to <code>suite.js</code></li>
					<li>Inside <code>suite.js</code>, towards the botton of the file, there will be an array named <code>tests</code>, add your new test to it like this:<pre><code class="language-js"><span style="color: #002339">tests: [</span>
<span style="color: #002339"> </span><span style="color: #A44185">&#039;./tests/fingerprint&#039;</span><span style="color: #002339">,</span>
<span style="color: #002339"> </span><span style="color: #A44185">&#039;./tests/led&#039;</span><span style="color: #002339">,</span>
<span style="color: #002339"> </span><span style="color: #A44185">&#039;./tests/config-json&#039;</span><span style="color: #002339">,</span>
<span style="color: #002339"> </span><span style="color: #A44185">&#039;./tests/connectivity&#039;</span><span style="color: #002339">,</span>
<span style="color: #002339"> </span><span style="color: #A44185">&#039;./tests/&lt;MY_NEw_TEST&gt;&#039;</span><span style="color: #002339">,</span>
<span style="color: #002339"> ],</span>
</code></pre>
					</li>
					<li>Ensure that any new dependencies used in your test are added to the <code>package.json</code></li>
				</ol>
				<a href="#writing-the-test-logic" id="writing-the-test-logic" style="color: inherit; text-decoration: none;">
					<h3>Writing the test logic</h3>
				</a>
				<p>Tests must be written in node, and are ingested by a framework called <a href="https://node-tap.org/docs/api/asserts/">node-tap</a>.
				To write a new test, inside <code>tests/&lt;MY_NEw_TEST&gt;/index.js</code> , we can use the following template (note that this file can contain a set of tests - you just have to have multiple objects in the <code>tests</code> array!)</p>
				<p>Each test is an asychnronous function, assigned to the <code>run</code> attribute of a test.</p>
				<pre><code class="language-js"><span style="color: #A44185">&#039;use strict&#039;</span><span style="color: #002339">;</span>

<span style="color: #DC3EB7">module</span><span style="color: #002339">.</span><span style="color: #DC3EB7">exports</span><span style="color: #002339"> </span><span style="color: #7B30D0">=</span><span style="color: #002339"> {</span>
<span style="color: #002339">    title: </span><span style="color: #A44185">&#039;Your name for the collection of tests in this file goes here&#039;</span><span style="color: #002339">,</span>
<span style="color: #002339">    tests: [</span>
<span style="color: #002339">        {</span>
<span style="color: #002339">            title: </span><span style="color: #A44185">&#039;The test name goes here&#039;</span><span style="color: #002339">,</span>
<span style="color: #002339">            </span><span style="color: #7EB233">run</span><span style="color: #002339">: </span><span style="color: #DA5221">async</span><span style="color: #002339"> </span><span style="color: #0991B6">function</span><span style="color: #002339">(</span><span style="color: #B1108E">test</span><span style="color: #002339">) { </span>
<span style="color: #002339">                </span><span style="color: #357B42">// put your test within an async function</span>
<span style="color: #002339">                </span><span style="color: #357B42">// For example, we want to test this addition function</span>
<span style="color: #002339">                </span><span style="color: #357B42">// let addition = (a,b) =&gt;  a + b</span>

<span style="color: #002339">                </span><span style="color: #357B42">// Here you can use an assertion to determine the result of the test for example:</span>
<span style="color: #002339">                </span><span style="color: #357B42">// the `.is` assertion checks if result is === 42</span>
<span style="color: #002339">                </span><span style="color: #357B42">// test.is(addition(4,5), 42, &#039;Message&#039;);  The test fails with Message!</span>
<span style="color: #002339">                </span>
<span style="color: #002339">                </span><span style="color: #357B42">// the `.is` assertion checks that result === 8</span>
<span style="color: #002339">                </span><span style="color: #357B42">// test.is(addition(4,4), 8, &#039;Message&#039;);  The test passes!</span>
<span style="color: #002339">            },</span>
<span style="color: #002339">        },</span>
<span style="color: #002339">    ],</span>
<span style="color: #002339">};</span>
</code></pre>
				<p>The supported assertions can be found here: <a href="https://node-tap.org/docs/api/asserts/">https://node-tap.org/docs/api/asserts/</a></p>
				<p>More examples of test logic can be seen here: <a href="https://github.com/balena-os/meta-balena/blob/master/tests/suites/os/tests/fingerprint/index.js">https://github.com/balena-os/meta-balena/blob/master/tests/suites/os/tests/fingerprint/index.js</a> for a very simple test, and here: <a href="https://github.com/balena-os/meta-balena/blob/master/tests/suites/os/tests/connectivity/index.js">https://github.com/balena-os/meta-balena/blob/master/tests/suites/os/tests/connectivity/index.js</a> for more complex tests. </p>
				<a href="#writing-a-new-suite" id="writing-a-new-suite" style="color: inherit; text-decoration: none;">
					<h3>Writing a new suite</h3>
				</a>
				<p>A new test suite can be created using the folder structure described at the start of this document. A new folder in the suites folder will be the start of the new suite. After you are finished writing the test suite, add the path of the test suite to the <code>suite</code> property in your <code>workspace/config.js</code></p>
				<p>Check out some tips and references for <a href="reference-tips.html">writing better tests</a> with Leviathan.</p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="label pp-nav pp-group">
						<span>Getting-<wbr><wbr>Started</span>
					</li>
					<li class=" pp-nav pp-page pp-parent">
						<a href="quickstart.html">Quickstart</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="config-reference.html">Config.js <wbr>Reference</a>
					</li>
					<li class="current pp-nav pp-page">
						<a href="writing-tests.html">Writing tests</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="debugging.html">Debugging tests in <wbr>Leviathan</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="reference-tips.html">Tips and <wbr>Reference</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="learn-more.html">Links, and more links</a>
					</li>
					<li class="label pp-nav pp-group">
						<span>Helper <wbr>Methods</span>
					</li>
					<li class=" ">
						<a href="../../modules.html">Modules</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/Archiver.html">Archiver</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/Context.html">Context</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/Graphics.html">Graphics</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/Leviathan_Utility_helpers.html">Leviathan <wbr>Utility helpers</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/Leviathan_Worker_helpers.html">Leviathan <wbr>Worker helpers</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/State.html">State</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/Suite.html">Suite</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/TaskQueue.html">Task<wbr>Queue</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/Test.html">Test</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/balenaCLI_helpers.html">balenaCLI helpers</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/balenaOS_helpers.html">balenaOS helpers</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/balenaSDK_helpers.html">balenaSDK helpers</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-namespace"><span class="tsd-kind-icon">Namespace</span></li>
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="../../assets/js/main.js"></script>
<script>if (location.protocol == 'file:') document.write('<script src="../../assets/js/search.json"><' + '/script>');</script>
</body>
</html>