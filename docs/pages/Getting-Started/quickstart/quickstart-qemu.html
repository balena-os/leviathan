<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>QEMU worker | Leviathan Helpers</title>
	<meta name="description" content="Documentation for Leviathan Helpers">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="../../../assets/css/main.css">
	<link rel="stylesheet" href="../../../assets/css/pages.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="../../../assets/js/search.json" data-base="../../..">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="../../../index.html" class="title">Leviathan Helpers</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="../../../modules.html">Globals</a>
				</li>
				<li>
					<a href="../quickstart.html">Getting-Started</a>
				</li>
				<li>
					<a href="../quickstart.html">Quickstart</a>
				</li>
				<li>
					<a href="quickstart-qemu.html">QEMU worker</a>
				</li>
			</ul>
			<h1>QEMU worker</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#getting-started-with-qemu-worker" id="getting-started-with-qemu-worker" style="color: inherit; text-decoration: none;">
					<h1>Getting Started with QEMU Worker</h1>
				</a>
				<p>This is a quick start guide for using the leviathan framework with the QEMU worker.</p>
				<a href="#start-your-first-test-run" id="start-your-first-test-run" style="color: inherit; text-decoration: none;">
					<h2>Start your first test run</h2>
				</a>
				<p>For your first test run, we will be running the <a href="https://github.com/balena-os/leviathan/tree/master/suites/e2e">e2e test suite</a>.</p>
				<p>A balenaOS image that is used to flash and provision the device under test will be needed for the test. You can download an unmanaged image from <a href="https://www.balena.io/os/#download">balena.io/os</a>. Extract the downloaded balenaOS image you want to test with to the <code>workspace</code> directory and rename it to <code>balena.img</code> file.</p>
				<a href="#build-your-configjs-file" id="build-your-configjs-file" style="color: inherit; text-decoration: none;">
					<h2>Build your <code>config.js</code> file</h2>
				</a>
				<p>The config.js file is the master configuration file for your test run. The QEMU worker spins up and configures your device under test (DUT) accordingly with the settings provided in the <code>config.js</code> file. To know more about each property, refer to the <a href="../config-reference.html">Config.js reference</a>.</p>
				<p>To get started,</p>
				<ul>
					<li>Navigate to the <code>workspace</code> directory in leviathan.</li>
					<li>Create a <code>config.js</code> file in the <code>workspace</code> directory using the <code>config.example.js</code> file.</li>
					<li>The config.js file should look close to the following:</li>
				</ul>
				<pre><code class="language-js"><span style="color: #DC3EB7">module</span><span style="color: #002339">.</span><span style="color: #DC3EB7">exports</span><span style="color: #002339"> </span><span style="color: #7B30D0">=</span><span style="color: #002339"> {</span>
<span style="color: #002339">    deviceType: </span><span style="color: #A44185">&#039;genericx86-64-ext&#039;</span><span style="color: #002339">,</span>
<span style="color: #002339">    </span><span style="color: #357B42">// Multiple suites can be run on the same worker when specified as an array.</span>
<span style="color: #002339">    suite: </span><span style="color: #A44185">`${</span><span style="color: #2F86D2">__dirname</span><span style="color: #A44185">}/../suites/e2e`</span><span style="color: #002339">,</span>
<span style="color: #002339">    config: {</span>
<span style="color: #002339">        networkWired: </span><span style="color: #174781">false</span><span style="color: #002339">,</span>
<span style="color: #002339">        networkWireless: </span><span style="color: #174781">false</span><span style="color: #002339">,</span>
<span style="color: #002339">        downloadVersion: </span><span style="color: #A44185">&#039;latest&#039;</span><span style="color: #002339">,</span>
<span style="color: #002339">        balenaApiKey: </span><span style="color: #2F86D2">process</span><span style="color: #002339">.</span><span style="color: #2F86D2">env</span><span style="color: #002339">.</span><span style="color: #2F86D2">BALENACLOUD_API_KEY</span><span style="color: #002339">,</span>
<span style="color: #002339">        balenaApiUrl: </span><span style="color: #A44185">&#039;balena-cloud.com&#039;</span><span style="color: #002339">,</span>
<span style="color: #002339">        organization: </span><span style="color: #A44185">&#039;BALENACLOUD_ORG_GOES_HERE&#039;</span><span style="color: #002339">,</span>
<span style="color: #002339">    },</span>
<span style="color: #002339">    image: </span><span style="color: #A44185">`${</span><span style="color: #2F86D2">__dirname</span><span style="color: #A44185">}/balena.img`</span><span style="color: #002339">,</span>
<span style="color: #002339">    workers: [</span><span style="color: #A44185">&#039;http://localhost&#039;</span><span style="color: #002339">],</span>
<span style="color: #002339">};</span>
</code></pre>
				<p>Here, we are assuming that the device under test (DUT) is a <code>raspberrypi3</code>. The suite and the image property points to a valid test suite and balenaOS image that is going to be tested with. </p>
				<a href="#start-your-first-test-run-1" id="start-your-first-test-run-1" style="color: inherit; text-decoration: none;">
					<h2>Start your first test run</h2>
				</a>
				<p>To start the test run, navigate to the root of the leviathan directory and run the following command:</p>
				<pre><code><span style="color: #2F86D2">make</span><span style="color: #002339"> </span><span style="color: #2F86D2">local</span><span style="color: #7B30D0">-</span><span style="color: #2F86D2">test</span>
</code></pre>
				<p>This will first build the core and worker services and run the worker using docker-compose. Then, the test will run and the logs will start streaming on the terminal. Wait for the test scenario to finish and check the device logs on the dashboard in the meantime. </p>
				<p>A successful run of the e2e test suite without any errors makes sure that your QEMU worker is set up correctly and can be used for further tests.</p>
				<a href="#let39s-run-some-quotrealquot-tests" id="let39s-run-some-quotrealquot-tests" style="color: inherit; text-decoration: none;">
					<h2>Let&#39;s run some &quot;real&quot; tests</h2>
				</a>
				<p>We will start with a test run of the <a href="https://github.com/balena-os/meta-balena/tree/master/tests/suites">balenaOS unmanaged testing suite</a>. To get the tests, clone the meta-balena repository. The OS tests are located in the <code>tests/</code> directory.</p>
				<ul>
					<li>Either copy the <code>OS test suite</code> directory from meta-balena to the <code>workspace</code> directory </li>
					<li>or point the <code>suite</code> property to the path of the OS test suite in the meta-balena directory.</li>
				</ul>
				<pre><code class="language-js"><span style="color: #DC3EB7">module</span><span style="color: #002339">.</span><span style="color: #DC3EB7">exports</span><span style="color: #002339"> </span><span style="color: #7B30D0">=</span><span style="color: #002339"> {</span>
<span style="color: #002339">    deviceType: </span><span style="color: #A44185">&#039;genericx86-64-ext&#039;</span><span style="color: #002339">,</span>
<span style="color: #002339">    suite: </span><span style="color: #A44185">`${</span><span style="color: #2F86D2">__dirname</span><span style="color: #A44185">}/../suites/os`</span><span style="color: #002339">,</span>
<span style="color: #002339">    config: {</span>
<span style="color: #002339">        networkWired: </span><span style="color: #174781">false</span><span style="color: #002339">,</span>
<span style="color: #002339">        networkWireless: </span><span style="color: #174781">false</span><span style="color: #002339">,</span>
<span style="color: #002339">        downloadVersion: </span><span style="color: #A44185">&#039;latest&#039;</span><span style="color: #002339">,</span>
<span style="color: #002339">        balenaApiKey: </span><span style="color: #2F86D2">process</span><span style="color: #002339">.</span><span style="color: #2F86D2">env</span><span style="color: #002339">.</span><span style="color: #2F86D2">BALENACLOUD_API_KEY</span><span style="color: #002339">,</span>
<span style="color: #002339">        balenaApiUrl: </span><span style="color: #A44185">&#039;balena-cloud.com&#039;</span><span style="color: #002339">,</span>
<span style="color: #002339">        organization: </span><span style="color: #A44185">&#039;BALENACLOUD_ORG_GOES_HERE&#039;</span><span style="color: #002339">,</span>
<span style="color: #002339">    },</span>
<span style="color: #002339">    image: </span><span style="color: #A44185">`${</span><span style="color: #2F86D2">__dirname</span><span style="color: #A44185">}/balena.img`</span><span style="color: #002339">,</span>
<span style="color: #002339">    workers: [</span><span style="color: #A44185">&#039;http://localhost&#039;</span><span style="color: #002339">],</span>
<span style="color: #002339">};</span>
</code></pre>
				<ul>
					<li>Run <code>make local-test</code> in the root of the project and watch the logs. The logs will start streaming on the terminal for the test run.</li>
					<li>At the end of the run, reports and logs for the test run will be stored in <code>workspace/reports</code> directory.</li>
				</ul>
				<p>That&#39;s the end of the quick start guide, you successfully setup your QEMu worker and ran your first test suite.</p>
				<a href="#where-do-you-go-from-here" id="where-do-you-go-from-here" style="color: inherit; text-decoration: none;">
					<h2>Where do you go from here?</h2>
				</a>
				<ol>
					<li>Start by <a href="../writing-tests.html">writing your first test</a>.</li>
					<li>To know more about <code>config.js</code> and its properties, refer to <a href="../config-reference.html">Config.js reference</a>.</li>
					<li>To understand the bigger picture about the project read/watch these <a href="../learn-more.html">resources</a>.</li>
					<li>Some tips and references for <a href="../reference-tips.html">writing better tests</a> with Leviathan.</li>
					<li>Check out the source for tests that you ran, <a href="https://github.com/balena-os/leviathan/tree/master/suites">e2e test suite</a>.</li>
				</ol>
				<a href="#advanced" id="advanced" style="color: inherit; text-decoration: none;">
					<h2>Advanced</h2>
				</a>
				<p>Worker configuration variables can be specified in <code>docker-compose.local.yml</code>, under <code>environment</code>. The default configuration should suffice in most cases.</p>
				<table>
					<thead>
						<tr>
							<th>Variable</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>QEMU_ARCH</td>
							<td>Architecture to virtualize (default: x86_64)</td>
						</tr>
						<tr>
							<td>QEMU_CPUS</td>
							<td>Number of CPUs to virtualize (default: 4)</td>
						</tr>
						<tr>
							<td>QEMU_MEMORY</td>
							<td>Amount of memory to virtualize (default: 2G)</td>
						</tr>
						<tr>
							<td>QEMU_BRIDGE_NAME</td>
							<td>Name of bridge to use for networking (default: br0)</td>
						</tr>
						<tr>
							<td>QEMU_BRIDGE_ADDRESS</td>
							<td>IP address to assign to bridge</td>
						</tr>
						<tr>
							<td>QEMU_DHCP_RANGE</td>
							<td>Range of DHCP addresses to hand out to workers</td>
						</tr>
				</tbody></table>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="label pp-nav pp-group">
						<span>Getting-<wbr><wbr>Started</span>
					</li>
					<li class=" pp-nav pp-page pp-parent pp-active">
						<a href="../quickstart.html">Quickstart</a>
					</li>
					<li class=" pp-nav pp-page pp-child">
						<a href="quickstart-testbot.html">Testbot worker</a>
					</li>
					<li class="current pp-nav pp-page pp-child">
						<a href="quickstart-qemu.html">QEMU worker</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../config-reference.html">Config.js <wbr>Reference</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../writing-tests.html">Writing tests</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../debugging.html">Debugging tests in <wbr>Leviathan</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../reference-tips.html">Tips and <wbr>Reference</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="../learn-more.html">Links, and more links</a>
					</li>
					<li class="label pp-nav pp-group">
						<span>Helper <wbr>Methods</span>
					</li>
					<li class=" ">
						<a href="../../../modules.html">Modules</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../../modules/Archiver.html">Archiver</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../../modules/Context.html">Context</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../../modules/Graphics.html">Graphics</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../../modules/Leviathan_Utility_helpers.html">Leviathan <wbr>Utility helpers</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../../modules/Leviathan_Worker_helpers.html">Leviathan <wbr>Worker helpers</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../../modules/State.html">State</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../../modules/Suite.html">Suite</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../../modules/TaskQueue.html">Task<wbr>Queue</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../../modules/Test.html">Test</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../../modules/balenaCLI_helpers.html">balenaCLI helpers</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../../modules/balenaOS_helpers.html">balenaOS helpers</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../../modules/balenaSDK_helpers.html">balenaSDK helpers</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-namespace"><span class="tsd-kind-icon">Namespace</span></li>
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="../../../assets/js/main.js"></script>
<script>if (location.protocol == 'file:') document.write('<script src="../../../assets/js/search.json"><' + '/script>');</script>
</body>
</html>