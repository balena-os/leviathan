<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>TaskQueue | Leviathan Helpers</title><meta name="description" content="Documentation for Leviathan Helpers"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base=".."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="../assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">Leviathan Helpers</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb"><li><a href="../index.html">Leviathan Helpers</a></li><li><a href="TaskQueue.html">TaskQueue</a></li></ul><h1>Module TaskQueue</h1></div><section class="tsd-panel tsd-comment"><div class="tsd-comment tsd-typography"><a id="md:taskqueue" class="tsd-anchor"></a><h1><a href="#md:taskqueue">TaskQueue</a></h1><p>A queue of tasks to be carried out at a certain part of the suite or test.</p>
<a id="md:teardown" class="tsd-anchor"></a><h1><a href="#md:teardown">Teardown</a></h1><p>A TaskQueue used to maintain a list of tasks to execute at the end of the
suite or test. These will execute regardless of passing or failing.</p>
<pre><code class="language-js"><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-6">suite</span><span class="hl-1">.</span><span class="hl-6">teardown</span><span class="hl-1">.</span><span class="hl-0">register</span><span class="hl-1">(() </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">   </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Worker teardown&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">   </span><span class="hl-4">return</span><span class="hl-1"> </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-6">context</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">().</span><span class="hl-6">worker</span><span class="hl-1">.</span><span class="hl-0">teardown</span><span class="hl-1">();</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>If registered in the suite, this will be carried out upon the suite (the collection of tests
ending. You can also add individual teardowns within tests, that will execute when the individual
test has ended. In this example here, within the test, we create an applciation, and after the
test, we wish to remove that application:</p>
</div><div class="tsd-comment tsd-typography"><h4>Example</h4><pre><code class="language-js"><span class="hl-1"> </span><span class="hl-13">module</span><span class="hl-1">.</span><span class="hl-13">exports</span><span class="hl-1"> </span><span class="hl-3">=</span><span class="hl-1"> {</span><br/><span class="hl-1">     </span><span class="hl-9">title:</span><span class="hl-1"> </span><span class="hl-2">&#39;Example&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">         </span><span class="hl-9">tests:</span><span class="hl-1"> [</span><br/><span class="hl-1">             {</span><br/><span class="hl-1">                 </span><span class="hl-9">title:</span><span class="hl-1"> </span><span class="hl-2">&#39;Move device to another application&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">                 </span><span class="hl-0">run</span><span class="hl-9">:</span><span class="hl-1"> </span><span class="hl-14">async</span><span class="hl-1"> </span><span class="hl-7">function</span><span class="hl-1">(</span><span class="hl-15">test</span><span class="hl-1">) {</span><br/><span class="hl-1">                     </span><span class="hl-11">// create an app</span><br/><span class="hl-1">                     </span><span class="hl-4">await</span><span class="hl-1"> </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-6">context</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">().</span><span class="hl-6">balena</span><span class="hl-1">.</span><span class="hl-6">sdk</span><span class="hl-1">.</span><span class="hl-6">models</span><span class="hl-1">.</span><span class="hl-6">application</span><span class="hl-1">.</span><span class="hl-0">create</span><span class="hl-1">({</span><br/><span class="hl-1">                         </span><span class="hl-9">name:</span><span class="hl-1"> </span><span class="hl-8">APP</span><span class="hl-1">,</span><br/><span class="hl-1">                         </span><span class="hl-9">deviceType:</span><span class="hl-1"> </span><span class="hl-8">DEVICE_TYPE</span><span class="hl-1">,</span><br/><span class="hl-1">                         </span><span class="hl-9">organization:</span><span class="hl-1"> </span><span class="hl-8">ORG</span><span class="hl-1">,</span><br/><span class="hl-1">                     });</span><br/><span class="hl-1">                     </span><span class="hl-11">// Register a teardown that will remove the test when the test ends</span><br/><span class="hl-1">                     </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-6">teardown</span><span class="hl-1">.</span><span class="hl-0">register</span><span class="hl-1">(() </span><span class="hl-7">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">                         </span><span class="hl-4">return</span><span class="hl-1"> </span><span class="hl-5">this</span><span class="hl-1">.</span><span class="hl-6">context</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">().</span><span class="hl-6">balena</span><span class="hl-1">.</span><span class="hl-6">sdk</span><span class="hl-1">.</span><span class="hl-6">models</span><span class="hl-1">.</span><span class="hl-6">application</span><span class="hl-1">.</span><span class="hl-0">remove</span><span class="hl-1">(</span><span class="hl-8">APP</span><span class="hl-1">);</span><br/><span class="hl-1">                     });</span><br/><span class="hl-1">                     </span><span class="hl-11">// THE REST OF THE TEST CODE</span><br/><span class="hl-1">                 }</span><br/><span class="hl-1">             }</span><br/><span class="hl-1">         ]</span><br/><span class="hl-1"> }</span>
</code><button>Copy</button></pre>
</div></section><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/balena-os/leviathan/blob/ceb23c1c/core/lib/common/taskQueue.js#L1">lib/common/taskQueue.js:1</a></li></ul></aside><section class="tsd-panel-group tsd-index-group"><section class="tsd-panel tsd-index-panel"><h3 class="tsd-index-heading uppercase">Index</h3><section class="tsd-index-section"><h3 class="tsd-index-heading">Namespaces</h3><div class="tsd-index-list"><a href="TaskQueue.export_.html" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-4"></use></svg><span>export=</span></a>
</div></section><section class="tsd-index-section"><h3 class="tsd-index-heading">Variables</h3><div class="tsd-index-list"><a href="../variables/TaskQueue.export_-1.html" class="tsd-index-link"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-32"></use></svg><span>export=</span></a>
</div></section></section></section></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="../assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><ul><li><ul><li><a href="#md:taskqueue"><span>Task<wbr/>Queue</span></a></li><li><a href="#md:teardown"><span>Teardown</span></a></li></ul></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="../index.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="../assets/icons.svg#icon-1"></use></svg><span>Leviathan Helpers</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base=".."><li>Loading...</li></ul></nav></div></div></div><div class="tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div></body></html>