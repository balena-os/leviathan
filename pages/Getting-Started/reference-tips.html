<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Tips and Reference | Leviathan Helpers</title>
	<meta name="description" content="Documentation for Leviathan Helpers">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="../../assets/css/main.css">
	<link rel="stylesheet" href="../../assets/css/pages.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="../../assets/js/search.json" data-base="../..">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="../../index.html" class="title">Leviathan Helpers</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="../../modules.html">Globals</a>
				</li>
				<li>
					<a href="quickstart.html">Getting-Started</a>
				</li>
				<li>
					<a href="reference-tips.html">Tips and Reference</a>
				</li>
			</ul>
			<h1>Tips and Reference</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#tips-for-writing-tests-and-reference-guide" id="tips-for-writing-tests-and-reference-guide" style="color: inherit; text-decoration: none;">
					<h1>Tips for writing tests and reference guide</h1>
				</a>
				<a href="#worker" id="worker" style="color: inherit; text-decoration: none;">
					<h3>Worker</h3>
				</a>
				<p>The worker class can be used to control the testbot hardware. In the <code>suite.js</code> file, you can create an instance of it, and then use its methods to flash the DUT, power it on/off, and set up a network AP for the DUT to connect to. </p>
				<pre><code class="language-js"><span style="color: #0991B6">const</span><span style="color: #002339"> </span><span style="color: #2F86D2">Worker</span><span style="color: #002339"> </span><span style="color: #7B30D0">=</span><span style="color: #002339"> </span><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #7EB233">require</span><span style="color: #002339">(</span><span style="color: #A44185">&#039;common/worker&#039;</span><span style="color: #002339">);</span>
<span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #2F86D2">suite</span><span style="color: #002339">.</span><span style="color: #2F86D2">context</span><span style="color: #002339">.</span><span style="color: #7EB233">set</span><span style="color: #002339">({</span>
<span style="color: #002339">    worker: </span><span style="color: #7B30D0">new</span><span style="color: #002339"> </span><span style="color: #7EB233">Worker</span><span style="color: #002339">(</span><span style="color: #2F86D2">DEVICE_TYPE_SLUG</span><span style="color: #002339">, </span><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #7EB233">getLogger</span><span style="color: #002339">()), </span><span style="color: #357B42">// Add an instance of worker to the context</span>
<span style="color: #002339">});</span>
<span style="color: #0991B6">const</span><span style="color: #002339"> </span><span style="color: #2F86D2">Worker</span><span style="color: #002339"> </span><span style="color: #7B30D0">=</span><span style="color: #002339"> </span><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #7EB233">require</span><span style="color: #002339">(</span><span style="color: #A44185">&#039;common/worker&#039;</span><span style="color: #002339">);</span>
<span style="color: #0991B6">const</span><span style="color: #002339"> </span><span style="color: #2F86D2">worker</span><span style="color: #002339"> </span><span style="color: #7B30D0">=</span><span style="color: #002339"> </span><span style="color: #7B30D0">new</span><span style="color: #002339"> </span><span style="color: #7EB233">Worker</span><span style="color: #002339">(</span><span style="color: #2F86D2">DEVICE_TYPE_SLUG</span><span style="color: #002339">, </span><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #7EB233">getLogger</span><span style="color: #002339">())</span>
</code></pre>
				<p>The <code>this.getLogger()</code> method gets the logger that can be used from any suite.
				Once you have an instance of the`Worker class, you can use its methods like this:</p>
				<pre><code class="language-js"><span style="color: #0991B6">const</span><span style="color: #002339"> </span><span style="color: #2F86D2">Worker</span><span style="color: #002339"> </span><span style="color: #7B30D0">=</span><span style="color: #002339"> </span><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #7EB233">require</span><span style="color: #002339">(</span><span style="color: #A44185">&#039;common/worker&#039;</span><span style="color: #002339">);</span>
<span style="color: #0991B6">const</span><span style="color: #002339"> </span><span style="color: #2F86D2">worker</span><span style="color: #002339"> </span><span style="color: #7B30D0">=</span><span style="color: #002339"> </span><span style="color: #7B30D0">new</span><span style="color: #002339"> </span><span style="color: #7EB233">Worker</span><span style="color: #002339">(</span><span style="color: #2F86D2">DEVICE_TYPE_SLUG</span><span style="color: #002339">, </span><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #7EB233">getLogger</span><span style="color: #002339">())</span>

<span style="color: #7B30D0">await</span><span style="color: #002339"> </span><span style="color: #2F86D2">worker</span><span style="color: #002339">.</span><span style="color: #7EB233">network</span><span style="color: #002339">(</span><span style="color: #2F86D2">network</span><span style="color: #002339">: {</span>
<span style="color: #002339">    ssid: </span><span style="color: #2F86D2">SSID</span><span style="color: #002339">,</span>
<span style="color: #002339">    psk: </span><span style="color: #2F86D2">PASSWORD</span><span style="color: #002339">,</span>
<span style="color: #002339">    nat: </span><span style="color: #174781">true</span><span style="color: #002339">,</span>
<span style="color: #002339">})</span>
<span style="color: #7B30D0">await</span><span style="color: #002339"> </span><span style="color: #2F86D2">worker</span><span style="color: #002339">.</span><span style="color: #7EB233">off</span><span style="color: #002339">() </span><span style="color: #357B42">// turn off the power to the DUT</span>
<span style="color: #7B30D0">await</span><span style="color: #002339"> </span><span style="color: #2F86D2">worker</span><span style="color: #002339">.</span><span style="color: #7EB233">flash</span><span style="color: #002339">() </span><span style="color: #357B42">// flash the DUT</span>
<span style="color: #7B30D0">await</span><span style="color: #002339"> </span><span style="color: #2F86D2">worker</span><span style="color: #002339">.</span><span style="color: #7EB233">on</span><span style="color: #002339">()</span>
</code></pre>
				<p>Another helpful method of the worker is <code>executeCommandInHostOs</code>, which lets you execute command line operations in the host OS of the DUT.
				Assuming that the DUT is connected to the AP of the testbot:</p>
				<pre><code class="language-js"><span style="color: #0991B6">const</span><span style="color: #002339"> </span><span style="color: #2F86D2">Worker</span><span style="color: #002339"> </span><span style="color: #7B30D0">=</span><span style="color: #002339"> </span><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #7EB233">require</span><span style="color: #002339">(</span><span style="color: #A44185">&#039;common/worker&#039;</span><span style="color: #002339">);</span>
<span style="color: #0991B6">const</span><span style="color: #002339"> </span><span style="color: #2F86D2">worker</span><span style="color: #002339"> </span><span style="color: #7B30D0">=</span><span style="color: #002339"> </span><span style="color: #7B30D0">new</span><span style="color: #002339"> </span><span style="color: #7EB233">Worker</span><span style="color: #002339">(</span><span style="color: #2F86D2">DEVICE_TYPE_SLUG</span><span style="color: #002339">, </span><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #7EB233">getLogger</span><span style="color: #002339">())</span>
<span style="color: #7B30D0">await</span><span style="color: #002339"> </span><span style="color: #2F86D2">worker</span><span style="color: #002339">.</span><span style="color: #7EB233">executeCommandInHostOS</span><span style="color: #002339">(</span><span style="color: #A44185">&#039;cat /etc/hostname&#039;</span><span style="color: #002339">, </span><span style="color: #A44185">`${</span><span style="color: #2F86D2">UUID</span><span style="color: #A44185">}.local`</span><span style="color: #002339">);</span>
</code></pre>
				<a href="#context" id="context" style="color: inherit; text-decoration: none;">
					<h3>Context</h3>
				</a>
				<p>The context class lets you share instances of objects across different tests. For example, if we made an instance of the worker class in a suite, as above, other tests would not be able to see it. An instance of the context class has a <code>set()</code> and a <code>get()</code> method, to both add or fetch objects from the context. An example can be seen below:</p>
				<pre><code class="language-js"><span style="color: #0991B6">const</span><span style="color: #002339"> </span><span style="color: #2F86D2">Worker</span><span style="color: #002339"> </span><span style="color: #7B30D0">=</span><span style="color: #002339"> </span><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #7EB233">require</span><span style="color: #002339">(</span><span style="color: #A44185">&#039;common/worker&#039;</span><span style="color: #002339">);</span>

<span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #2F86D2">suite</span><span style="color: #002339">.</span><span style="color: #2F86D2">context</span><span style="color: #002339">.</span><span style="color: #7EB233">set</span><span style="color: #002339">({</span>
<span style="color: #002339">    worker: </span><span style="color: #7B30D0">new</span><span style="color: #002339"> </span><span style="color: #7EB233">Worker</span><span style="color: #002339">(</span><span style="color: #2F86D2">DEVICE_TYPE_SLUG</span><span style="color: #002339">, </span><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #7EB233">getLogger</span><span style="color: #002339">()), </span><span style="color: #357B42">// Add an instance of worker to the context</span>
<span style="color: #002339">});</span>

<span style="color: #7B30D0">await</span><span style="color: #002339"> </span><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #2F86D2">context</span><span style="color: #002339">.</span><span style="color: #7EB233">get</span><span style="color: #002339">().</span><span style="color: #2F86D2">worker</span><span style="color: #002339">.</span><span style="color: #7EB233">flash</span><span style="color: #002339">() </span><span style="color: #357B42">// flash the DUT with the worker instance thats in the context</span>
</code></pre>
				<p>The context can be used to share anything between tests - device uuids, app names and so on.</p>
				<a href="#os-helpers" id="os-helpers" style="color: inherit; text-decoration: none;">
					<h3>OS helpers</h3>
				</a>
				<p>The <code>BalenaOS</code> helper class can be used to configure and unpack the OS image that you will use in the test. This allows you to inject config options and network credentials into your image.</p>
				<pre><code class="language-js"><span style="color: #0991B6">const</span><span style="color: #002339"> </span><span style="color: #2F86D2">network_conf</span><span style="color: #002339"> </span><span style="color: #7B30D0">=</span><span style="color: #002339"> {</span>
<span style="color: #002339">    ssid: </span><span style="color: #2F86D2">SSID</span><span style="color: #002339">,</span>
<span style="color: #002339">    psk: </span><span style="color: #2F86D2">PASSWORD</span><span style="color: #002339">,</span>
<span style="color: #002339">    nat: </span><span style="color: #174781">true</span><span style="color: #002339">,</span>
<span style="color: #002339">}</span>

<span style="color: #0991B6">const</span><span style="color: #002339"> </span><span style="color: #2F86D2">os</span><span style="color: #002339"> </span><span style="color: #7B30D0">=</span><span style="color: #002339"> </span><span style="color: #7B30D0">new</span><span style="color: #002339"> </span><span style="color: #7EB233">BalenaOS</span><span style="color: #002339">(</span>
<span style="color: #002339">    {</span>
<span style="color: #002339">        deviceType: </span><span style="color: #2F86D2">DEVICE_TYPE_SLUG</span><span style="color: #002339">,</span>
<span style="color: #002339">        network: </span><span style="color: #2F86D2">network_conf</span><span style="color: #002339">,</span>
<span style="color: #002339">        configJson: {</span>
<span style="color: #002339">            uuid: </span><span style="color: #2F86D2">UUID</span><span style="color: #002339">,</span>
<span style="color: #002339">            persistentLogging: </span><span style="color: #174781">true</span><span style="color: #002339">,</span>
<span style="color: #002339">        },</span>
<span style="color: #002339">    },</span>
<span style="color: #002339">    </span><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #7EB233">getLogger</span><span style="color: #002339">(),</span>
<span style="color: #002339">);</span>

<span style="color: #7B30D0">await</span><span style="color: #002339"> </span><span style="color: #2F86D2">os</span><span style="color: #002339">.</span><span style="color: #7EB233">fetch</span><span style="color: #002339">();</span>

<span style="color: #7B30D0">await</span><span style="color: #002339"> </span><span style="color: #2F86D2">os</span><span style="color: #002339">.</span><span style="color: #7EB233">configure</span><span style="color: #002339">()</span>
</code></pre>
				<p>Alternatively, you can use the CLI to perform these functions - the CLI is imported in the testing environment:</p>
				<pre><code class="language-js"><span style="color: #7B30D0">await</span><span style="color: #002339"> </span><span style="color: #7EB233">exec</span><span style="color: #002339">(</span><span style="color: #A44185">`balena login --token ${</span><span style="color: #2F86D2">API_KEY</span><span style="color: #A44185">}`</span><span style="color: #002339">);</span>

<span style="color: #7B30D0">await</span><span style="color: #002339"> </span><span style="color: #7EB233">exec</span><span style="color: #002339">(</span>
<span style="color: #002339">    </span><span style="color: #A44185">`balena os configure ${</span><span style="color: #2F86D2">PATH_TO_IMAGE</span><span style="color: #A44185">}-a ${</span>
<span style="color: #A44185">    </span><span style="color: #A44185">} --config-network wifi --config-wifi-key ${</span>
<span style="color: #A44185">        </span><span style="color: #2F86D2">PASSWORD</span>
<span style="color: #A44185">    </span><span style="color: #A44185">}  --config-wifi-ssid ${</span>
<span style="color: #A44185">        </span><span style="color: #2F86D2">SSID</span>
<span style="color: #A44185">    </span><span style="color: #A44185">}  `</span><span style="color: #002339">,</span>
<span style="color: #002339">); </span>
</code></pre>
				<a href="#cloud-helpers" id="cloud-helpers" style="color: inherit; text-decoration: none;">
					<h3>Cloud helpers</h3>
				</a>
				<p>The <code>BalenaSDK</code> class, defined in <a href="https://github.com/balena-os/leviathan/blob/master/core/lib/components/balena/sdk.js"><code>core/components/balena/sdk</code></a>, contains an instance of the balena sdk, as well as some helper methods. The <code>balena</code> attribute of the class contains the sdk, which can then be used as follows:</p>
				<pre><code class="language-js"><span style="color: #0991B6">const</span><span style="color: #002339"> </span><span style="color: #2F86D2">Cloud</span><span style="color: #002339"> </span><span style="color: #7B30D0">=</span><span style="color: #002339"> </span><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #7EB233">require</span><span style="color: #002339">(</span><span style="color: #A44185">&quot;components/balena/sdk&quot;</span><span style="color: #002339">);</span>

<span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #2F86D2">suite</span><span style="color: #002339">.</span><span style="color: #2F86D2">context</span><span style="color: #002339">.</span><span style="color: #7EB233">set</span><span style="color: #002339">({</span>
<span style="color: #002339">    cloud: </span><span style="color: #7B30D0">new</span><span style="color: #002339"> </span><span style="color: #7EB233">Balena</span><span style="color: #002339">(</span><span style="color: #A44185">`https://api.balena-cloud.com/`</span><span style="color: #002339">, </span><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #7EB233">getLogger</span><span style="color: #002339">())</span>
<span style="color: #002339">});</span>


<span style="color: #357B42">// login</span>
<span style="color: #7B30D0">await</span><span style="color: #002339"> </span><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #2F86D2">context</span>
<span style="color: #002339">    .</span><span style="color: #7EB233">get</span><span style="color: #002339">()</span>
<span style="color: #002339">    .</span><span style="color: #2F86D2">cloud</span><span style="color: #002339">.</span><span style="color: #2F86D2">balena</span><span style="color: #002339">.</span><span style="color: #2F86D2">auth</span><span style="color: #002339">.</span><span style="color: #7EB233">loginWithToken</span><span style="color: #002339">(</span><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #2F86D2">suite</span><span style="color: #002339">.</span><span style="color: #2F86D2">options</span><span style="color: #002339">.</span><span style="color: #2F86D2">balena</span><span style="color: #002339">.</span><span style="color: #2F86D2">apiKey</span><span style="color: #002339">);</span>

<span style="color: #357B42">// create a balena application</span>
<span style="color: #7B30D0">await</span><span style="color: #002339"> </span><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #2F86D2">context</span><span style="color: #002339">.</span><span style="color: #7EB233">get</span><span style="color: #002339">().</span><span style="color: #2F86D2">cloud</span><span style="color: #002339">.</span><span style="color: #2F86D2">balena</span><span style="color: #002339">.</span><span style="color: #2F86D2">models</span><span style="color: #002339">.</span><span style="color: #2F86D2">application</span><span style="color: #002339">.</span><span style="color: #7EB233">create</span><span style="color: #002339">({</span>
<span style="color: #002339">    name: </span><span style="color: #A44185">`NAME`</span><span style="color: #002339">,</span>
<span style="color: #002339">    deviceType: </span><span style="color: #A44185">`DEVICE_TYPE`</span><span style="color: #002339">,</span>
<span style="color: #002339">    organization: </span><span style="color: #A44185">`ORG`</span><span style="color: #002339">,</span>
<span style="color: #002339">});</span>

</code></pre>
				<p>Alternatively, Balena SDK is imported into the testing environment by default, so you can create an instance of the SDK and use it without the cloud helpers class:</p>
				<pre><code class="language-js"><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #2F86D2">suite</span><span style="color: #002339">.</span><span style="color: #2F86D2">context</span><span style="color: #002339">.</span><span style="color: #7EB233">set</span><span style="color: #002339">({</span>
<span style="color: #002339">    balena: {</span>
<span style="color: #002339">        sdk: </span><span style="color: #7EB233">getSdk</span><span style="color: #002339">({</span>
<span style="color: #002339">            apiUrl: </span><span style="color: #A44185">&#039;https://api.balena-cloud.com/&#039;</span><span style="color: #002339">,</span>
<span style="color: #002339">        }),</span>
<span style="color: #002339">        sshKey: { label: </span><span style="color: #2F86D2">LABEL</span><span style="color: #002339">},</span>
<span style="color: #002339">    }</span>
<span style="color: #002339">});</span>

<span style="color: #7B30D0">await</span><span style="color: #002339"> </span><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #2F86D2">context</span><span style="color: #002339">.</span><span style="color: #7EB233">get</span><span style="color: #002339">().</span><span style="color: #2F86D2">balena</span><span style="color: #002339">.</span><span style="color: #2F86D2">sdk</span><span style="color: #002339">.</span><span style="color: #2F86D2">auth</span><span style="color: #002339">.</span><span style="color: #7EB233">loginWithToken</span><span style="color: #002339">(</span><span style="color: #2F86D2">TOKEN</span><span style="color: #002339">);</span>
<span style="color: #7B30D0">await</span><span style="color: #002339"> </span><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #2F86D2">context</span><span style="color: #002339">.</span><span style="color: #7EB233">get</span><span style="color: #002339">().</span><span style="color: #2F86D2">balena</span><span style="color: #002339">.</span><span style="color: #2F86D2">sdk</span><span style="color: #002339">.</span><span style="color: #2F86D2">models</span><span style="color: #002339">.</span><span style="color: #2F86D2">application</span><span style="color: #002339">.</span><span style="color: #7EB233">create</span><span style="color: #002339">({</span>
<span style="color: #002339">    name: </span><span style="color: #2F86D2">APP_NAME</span><span style="color: #002339">,</span>
<span style="color: #002339">    deviceType: </span><span style="color: #2F86D2">DEVICE_TYPE_SLUG</span><span style="color: #002339">,</span>
<span style="color: #002339">    organization: </span><span style="color: #2F86D2">ORG</span><span style="color: #002339">,</span>
<span style="color: #002339">})</span>
</code></pre>
				<a href="#suite-node-dependencies" id="suite-node-dependencies" style="color: inherit; text-decoration: none;">
					<h3>Suite node dependencies</h3>
				</a>
				<p>Each suite also has its own <code>package.json</code> that can be used to list dependencies for any tests in that suite, if those packages aren&#39;y already present within the testing environment.</p>
				<a href="#teardowns" id="teardowns" style="color: inherit; text-decoration: none;">
					<h3>Teardowns</h3>
				</a>
				<p>You can register functions to be carried out upon &quot;teardown&quot; of the suite or test. These will execute when the test ends, regardless of passing or failing:</p>
				<pre><code class="language-js"><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #2F86D2">suite</span><span style="color: #002339">.</span><span style="color: #2F86D2">teardown</span><span style="color: #002339">.</span><span style="color: #7EB233">register</span><span style="color: #002339">(() </span><span style="color: #0991B6">=&gt;</span><span style="color: #002339"> {</span>
<span style="color: #002339">    </span><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #7EB233">log</span><span style="color: #002339">(</span><span style="color: #A44185">&#039;Worker teardown&#039;</span><span style="color: #002339">);</span>
<span style="color: #002339">    </span><span style="color: #7B30D0">return</span><span style="color: #002339"> </span><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #2F86D2">context</span><span style="color: #002339">.</span><span style="color: #7EB233">get</span><span style="color: #002339">().</span><span style="color: #2F86D2">worker</span><span style="color: #002339">.</span><span style="color: #7EB233">teardown</span><span style="color: #002339">();</span>
<span style="color: #002339">});</span>
</code></pre>
				<p>If registered in the suite, this will be carried out upon the suite (the collection of tests) ending. You can also add individual teardowns within tests, that will execute when the individual test has ended. In this example here, within the test, we create an applciation, and after the test, we wish to remove that application:</p>
				<pre><code class="language-js"><span style="color: #DC3EB7">module</span><span style="color: #002339">.</span><span style="color: #DC3EB7">exports</span><span style="color: #002339"> </span><span style="color: #7B30D0">=</span><span style="color: #002339"> {</span>
<span style="color: #002339">    title: </span><span style="color: #A44185">&#039;Example&#039;</span><span style="color: #002339">,</span>
<span style="color: #002339">        tests: [</span>
<span style="color: #002339">            {</span>
<span style="color: #002339">                title: </span><span style="color: #A44185">&#039;Move device to another application&#039;</span><span style="color: #002339">,</span>
<span style="color: #002339">                </span><span style="color: #7EB233">run</span><span style="color: #002339">: </span><span style="color: #DA5221">async</span><span style="color: #002339"> </span><span style="color: #0991B6">function</span><span style="color: #002339">(</span><span style="color: #B1108E">test</span><span style="color: #002339">) {</span>
<span style="color: #002339">                    </span><span style="color: #357B42">// create an app</span>
<span style="color: #002339">                    </span><span style="color: #7B30D0">await</span><span style="color: #002339"> </span><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #2F86D2">context</span><span style="color: #002339">.</span><span style="color: #7EB233">get</span><span style="color: #002339">().</span><span style="color: #2F86D2">balena</span><span style="color: #002339">.</span><span style="color: #2F86D2">sdk</span><span style="color: #002339">.</span><span style="color: #2F86D2">models</span><span style="color: #002339">.</span><span style="color: #2F86D2">application</span><span style="color: #002339">.</span><span style="color: #7EB233">create</span><span style="color: #002339">({</span>
<span style="color: #002339">                        name: </span><span style="color: #2F86D2">APP</span><span style="color: #002339">,</span>
<span style="color: #002339">                        deviceType: </span><span style="color: #2F86D2">DEVICE_TYPE</span><span style="color: #002339">,</span>
<span style="color: #002339">                        organization: </span><span style="color: #2F86D2">ORG</span><span style="color: #002339">,</span>
<span style="color: #002339">                    });</span>
<span style="color: #002339">                    </span><span style="color: #357B42">// Register a teardown that will remove the test when the test ends</span>
<span style="color: #002339">                    </span><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #2F86D2">teardown</span><span style="color: #002339">.</span><span style="color: #7EB233">register</span><span style="color: #002339">(() </span><span style="color: #0991B6">=&gt;</span><span style="color: #002339"> {</span>
<span style="color: #002339">                        </span><span style="color: #7B30D0">return</span><span style="color: #002339"> </span><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #2F86D2">context</span><span style="color: #002339">.</span><span style="color: #7EB233">get</span><span style="color: #002339">().</span><span style="color: #2F86D2">balena</span><span style="color: #002339">.</span><span style="color: #2F86D2">sdk</span><span style="color: #002339">.</span><span style="color: #2F86D2">models</span><span style="color: #002339">.</span><span style="color: #2F86D2">application</span><span style="color: #002339">.</span><span style="color: #7EB233">remove</span><span style="color: #002339">(</span><span style="color: #2F86D2">APP</span><span style="color: #002339">);</span>
<span style="color: #002339">                    });</span>

<span style="color: #002339">                    </span><span style="color: #357B42">// THE REST OF THE TEST CODE</span>
<span style="color: #002339">                }</span>
<span style="color: #002339">            }</span>
<span style="color: #002339">        ]</span>
<span style="color: #002339">}</span>
</code></pre>
				<a href="#screen-capture" id="screen-capture" style="color: inherit; text-decoration: none;">
					<h3>Screen capture</h3>
				</a>
				<p>If screen capture is supported and appropriate hardware is attached, the video output of the DUT can be captured. For the testbot, this requires a compatible video capture device to be connected, that works with v4L2 and enumerates on the <code>/dev/video0</code> interface.</p>
				<p>If that is the case, then capture can be started using the <code>Worker</code> class <code>capture()</code> method, for example:</p>
				<pre><code class="language-js"><span style="color: #0991B6">const</span><span style="color: #002339"> </span><span style="color: #2F86D2">Worker</span><span style="color: #002339"> </span><span style="color: #7B30D0">=</span><span style="color: #002339"> </span><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #7EB233">require</span><span style="color: #002339">(</span><span style="color: #A44185">&#039;common/worker&#039;</span><span style="color: #002339">);</span>
<span style="color: #0991B6">const</span><span style="color: #002339"> </span><span style="color: #2F86D2">worker</span><span style="color: #002339"> </span><span style="color: #7B30D0">=</span><span style="color: #002339"> </span><span style="color: #7B30D0">new</span><span style="color: #002339"> </span><span style="color: #7EB233">Worker</span><span style="color: #002339">(</span><span style="color: #A44185">&#039;DEVICE_TYPE_SLUG&#039;</span><span style="color: #002339">, </span><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #7EB233">getLogger</span><span style="color: #002339">())</span>
<span style="color: #7B30D0">await</span><span style="color: #002339"> </span><span style="color: #2F86D2">worker</span><span style="color: #002339">.</span><span style="color: #7EB233">capture</span><span style="color: #002339">(</span><span style="color: #A44185">&#039;start&#039;</span><span style="color: #002339">);</span>
</code></pre>
				<p>This will trigger video capture to start, and frames will be saved as <code>jpg</code> files in the <code>/data/capture</code> directory (which is a shared volume). Capture will continue until stopped with:</p>
				<pre><code class="language-js"><span style="color: #7B30D0">await</span><span style="color: #002339"> </span><span style="color: #2F86D2">worker</span><span style="color: #002339">.</span><span style="color: #7EB233">capture</span><span style="color: #002339">(</span><span style="color: #A44185">&#039;stop&#039;</span><span style="color: #002339">);</span>
</code></pre>
				<a href="#sending-reports-and-artifacts-back-to-the-client-from-the-testbot" id="sending-reports-and-artifacts-back-to-the-client-from-the-testbot" style="color: inherit; text-decoration: none;">
					<h3>Sending reports and artifacts back to the client from the testbot</h3>
				</a>
				<p>By default, serial logs (given that the hardware is set up correctly), and the logs from the tests will be sent back to the client that started the test, upon the test finishing. Other artifacts can be sent back to the client using the <code>archiver</code> method. This method is available within any test:</p>
				<pre><code class="language-js"><span style="color: #000000">this</span><span style="color: #002339">.</span><span style="color: #2F86D2">archiver</span><span style="color: #002339">.</span><span style="color: #7EB233">add</span><span style="color: #002339">(</span><span style="color: #A44185">`FILE OR DIRECTORY`</span><span style="color: #002339">)</span>
</code></pre>
				<p>Using this method, at the end of the test, any artifacts added to the archive are compressed and downloaded by the client. These are available in the <code>workspace/reports</code> directory at the end of the test.</p>
				<a href="#what-should-go-in-the-suitejs-of-a-suite" id="what-should-go-in-the-suitejs-of-a-suite" style="color: inherit; text-decoration: none;">
					<h3>What should go in the suite.js of a suite</h3>
				</a>
				<p>The recommended pattern is to put the code that gets the device into the state ready for the tests, into the suite.
				Usually, this will include:</p>
				<ul>
					<li>creating an instance of the worker class</li>
					<li>configuring the OS image with the correct configuration and network settings</li>
					<li>setting up the network of the testbot (using <code>Worker.network()</code>)</li>
					<li>flashing the DUT (using <code>Worker.flash()</code>)</li>
					<li>Checking that the device is online</li>
					<li>listing the tests</li>
				</ul>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="label pp-nav pp-group">
						<span>Getting-<wbr><wbr>Started</span>
					</li>
					<li class=" pp-nav pp-page pp-parent">
						<a href="quickstart.html">Quickstart</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="config-reference.html">Config.js <wbr>Reference</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="writing-tests.html">Writing tests</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="debugging.html">Debugging tests in <wbr>Leviathan</a>
					</li>
					<li class="current pp-nav pp-page">
						<a href="reference-tips.html">Tips and <wbr>Reference</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="learn-more.html">Links, and more links</a>
					</li>
					<li class="label pp-nav pp-group">
						<span>Helper <wbr>Methods</span>
					</li>
					<li class=" ">
						<a href="../../modules.html">Modules</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/Archiver.html">Archiver</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/Context.html">Context</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/Graphics.html">Graphics</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/Leviathan_Utility_helpers.html">Leviathan <wbr>Utility helpers</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/Leviathan_Worker_helpers.html">Leviathan <wbr>Worker helpers</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/State.html">State</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/Suite.html">Suite</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/TaskQueue.html">Task<wbr>Queue</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/Test.html">Test</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/balenaCLI_helpers.html">balenaCLI helpers</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/balenaOS_helpers.html">balenaOS helpers</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/balenaSDK_helpers.html">balenaSDK helpers</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-namespace"><span class="tsd-kind-icon">Namespace</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="../../assets/js/main.js"></script>
<script>if (location.protocol == 'file:') document.write('<script src="../../assets/js/search.json"><' + '/script>');</script>
</body>
</html>